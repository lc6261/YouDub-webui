# YouDub-webui 辅助脚本使用说明

## 1. 概述

YouDub-webui 提供了多个辅助脚本，用于简化项目的使用和管理。这些脚本包括任务完成检测、任务重建、环境验证等功能，帮助用户更好地管理和监控视频处理任务。本文档详细介绍这些辅助脚本的功能、使用方法和参数。

## 2. 辅助脚本列表

| 脚本名称 | 脚本文件 | 功能描述 |
|---------|---------|---------|
| 任务完成检测 | check_tasks_completion.py | 检测所有任务的实际完成情况 |
| 任务重建 | recreate_tasks.py | 从现有视频重建任务列表 |
| 环境验证 | verify/verify_env_info.py | 验证系统环境信息 |
| TTS 模型验证 | verify/test_tts_models.py | 测试不同的 TTS 模型 |
| 语音克隆测试 | verify/test_clone_audio.py | 测试语音克隆功能 |
| 音量测试 | remove_empyt.py | 清理空目录和文件 |

## 3. 详细脚本说明

### 3.1 任务完成检测脚本 (check_tasks_completion.py)

#### 3.1.1 功能描述

检测所有任务的实际完成情况，不仅检查 `tasks.csv` 中的状态字段，还会验证实际文件是否存在。

#### 3.1.2 使用方法

```bash
# 基本用法
python check_tasks_completion.py

# 激活虚拟环境后使用
venv\Scripts\activate
python check_tasks_completion.py
```

#### 3.1.3 输出说明

脚本会输出每个任务的详细信息，包括：
- 任务 URL
- 任务类型
- 状态字段
- 实际状态
- 视频文件夹路径
- 检查文件路径
- 文件存在状态
- 状态匹配情况

最后会输出汇总信息，包括：
- 总任务数
- 实际完成数
- 状态不匹配数

#### 3.1.4 示例输出

```
🎬 开始检测所有任务的完成情况...
================================================================================
📋 任务 1:
   URL: https://www.youtube.com/shorts/g2A_lVix03I
   任务类型: download_only
   状态字段: completed
   实际状态: 已完成
   视频文件夹: K:\work\5.AI\YouDub-webui\videos\Jackson Cole\20251213 Why can t dogs eat in small bites funnyvideos foryou fyp dogsoftiktok funnypets
   检查文件: K:\work\5.AI\YouDub-webui\videos\Jackson Cole\20251213 Why can t dogs eat in small bites funnyvideos foryou fyp dogsoftiktok funnypets\download.mp4
   文件存在: ✅

...

================================================================================
📊 任务完成情况汇总:
   总任务数: 30
   实际完成数: 30
   状态不匹配数: 0
🎉 所有任务都已完成！
================================================================================
```

### 3.2 任务重建脚本 (recreate_tasks.py)

#### 3.2.1 功能描述

从现有视频文件重建 `tasks.csv` 文件，当 `tasks.csv` 文件丢失或损坏时非常有用。

#### 3.2.2 使用方法

```bash
# 基本用法
python recreate_tasks.py

# 激活虚拟环境后使用
venv\Scripts\activate
python recreate_tasks.py
```

#### 3.2.3 工作原理

1. 扫描 `videos` 目录下的所有视频文件夹
2. 读取每个文件夹中的 `download.info.json` 文件获取视频元数据
3. 根据文件夹结构和文件存在情况确定任务类型和状态
4. 生成新的 `tasks.csv` 文件

#### 3.2.4 注意事项

- 脚本会覆盖现有的 `tasks.csv` 文件，请确保在运行前备份重要数据
- 脚本需要读取 `download.info.json` 文件获取视频元数据，如果该文件不存在，可能无法正确生成任务

### 3.3 环境验证脚本 (verify/verify_env_info.py)

#### 3.3.1 功能描述

验证系统环境信息，包括 Python 版本、CUDA 环境、依赖包版本等。

#### 3.3.2 使用方法

```bash
# 基本用法
python verify/verify_env_info.py

# 激活虚拟环境后使用
venv\Scripts\activate
python verify/verify_env_info.py
```

#### 3.3.3 输出说明

脚本会输出系统环境的详细信息，包括：
- Python 版本和路径
- CUDA 版本和可用性
- 主要依赖包的版本
- 系统信息（CPU、GPU、内存等）

### 3.4 TTS 模型验证脚本 (verify/test_tts_models.py)

#### 3.4.1 功能描述

测试不同的 TTS 模型，比较它们的合成效果。

#### 3.4.2 使用方法

```bash
# 基本用法
python verify/test_tts_models.py

# 激活虚拟环境后使用
venv\Scripts\activate
python verify/test_tts_models.py
```

#### 3.4.3 工作原理

1. 加载不同的 TTS 模型
2. 使用相同的文本输入合成语音
3. 将合成结果保存到指定目录
4. 输出模型加载时间和合成时间

#### 3.4.4 输出文件

- `test_tts_output/` 目录：包含不同 TTS 模型的合成结果

### 3.5 语音克隆测试脚本 (verify/test_clone_audio.py)

#### 3.5.1 功能描述

测试语音克隆功能，生成不同风格的克隆语音。

#### 3.5.2 使用方法

```bash
# 基本用法
python verify/test_clone_audio.py

# 激活虚拟环境后使用
venv\Scripts\activate
python verify/test_clone_audio.py
```

#### 3.5.3 参数说明

| 参数名 | 类型 | 默认值 | 描述 |
|-------|------|--------|------|
| --input | string | voice/aw.mp3 | 输入参考音频文件 |
| --text | string | 你好，这是一个语音克隆测试 | 合成文本 |
| --output | string | test_clone_output | 输出目录 |

#### 3.5.4 输出文件

- `test_clone_output/` 目录：包含不同风格的克隆语音结果

### 3.6 清理脚本 (remove_empyt.py)

#### 3.6.1 功能描述

清理项目中的空目录和文件，释放存储空间。

#### 3.6.2 使用方法

```bash
# 基本用法
python remove_empyt.py

# 激活虚拟环境后使用
venv\Scripts\activate
python remove_empyt.py
```

#### 3.6.3 工作原理

1. 扫描指定目录（默认是当前目录）
2. 识别并删除空目录
3. 识别并删除大小为 0 的文件
4. 输出清理结果

#### 3.6.4 参数说明

| 参数名 | 类型 | 默认值 | 描述 |
|-------|------|--------|------|
| --dir | string | . | 要扫描的目录 |
| --dry-run | bool | False | 只显示要删除的文件和目录，不实际删除 |

## 4. 辅助脚本的最佳实践

### 4.1 定期运行任务完成检测

建议定期运行 `check_tasks_completion.py` 脚本，确保任务状态与实际完成情况一致。

```bash
# 每周运行一次任务完成检测
python check_tasks_completion.py > task_status_report.txt
```

### 4.2 备份任务列表

在运行 `recreate_tasks.py` 脚本前，建议先备份现有的 `tasks.csv` 文件。

```bash
# 备份 tasks.csv 文件
copy tasks.csv tasks.csv.backup
# 运行任务重建脚本
python recreate_tasks.py
```

### 4.3 验证环境后再运行项目

在首次运行项目或更新依赖后，建议运行环境验证脚本，确保环境配置正确。

```bash
# 验证环境
python verify/verify_env_info.py
# 如果环境验证通过，启动项目
python run_windows.bat
```

### 4.4 测试 TTS 模型后再选择

在使用 TTS 合成功能前，建议运行 TTS 模型验证脚本，选择最适合的 TTS 模型。

```bash
# 测试 TTS 模型
python verify/test_tts_models.py
# 根据测试结果，在配置文件中选择合适的 TTS 模型
```

## 5. 常见问题与解决方案

### 5.1 脚本运行失败

- **问题**: 脚本运行时出现错误
- **解决方案**: 确保已激活虚拟环境，检查依赖包是否已安装，查看错误信息以确定具体问题

### 5.2 任务重建失败

- **问题**: `recreate_tasks.py` 脚本无法正确重建任务
- **解决方案**: 确保 `videos` 目录下存在视频文件和 `download.info.json` 文件，检查文件格式是否正确

### 5.3 TTS 模型测试失败

- **问题**: `test_tts_models.py` 脚本无法加载 TTS 模型
- **解决方案**: 确保已安装 TTS 依赖，检查模型文件是否存在，确保网络连接正常

## 6. 总结

YouDub-webui 的辅助脚本提供了多种功能，帮助用户更好地管理和使用项目。这些脚本包括任务管理、环境验证、模型测试等功能，可以提高项目的使用效率和可靠性。

通过定期运行这些辅助脚本，可以确保项目始终处于良好的运行状态，及时发现和解决问题。同时，这些脚本也可以帮助用户更好地了解项目的内部机制，提高使用体验。

建议用户根据自己的需求，合理使用这些辅助脚本，充分发挥它们的作用。
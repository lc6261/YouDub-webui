# YouDub-webui 配置文件说明

## 1. 配置文件概述

YouDub-webui 使用多种配置文件来管理系统行为，包括环境变量配置、模型配置、批量任务配置等。本文档详细介绍这些配置文件的格式、参数和使用方法，帮助用户正确配置系统以满足不同需求。

## 2. 环境配置文件 (.env)

### 2.1 文件格式

`.env` 文件是一个简单的键值对文件，用于配置系统的环境变量。

### 2.2 配置参数

| 参数名 | 类型 | 必填 | 默认值 | 描述 |
|-------|------|------|--------|------|
| OPENAI_API_KEY | string | 否 | - | OpenAI API 密钥，用于字幕翻译 |
| MODEL_NAME | string | 否 | gpt-3.5-turbo | 翻译模型名称，如 gpt-3.5-turbo, gpt-4 |
| OPENAI_API_BASE | string | 否 | https://api.openai.com/v1 | OpenAI API 基础 URL，用于自定义 API 端点 |
| HF_TOKEN | string | 否 | - | Hugging Face token，用于说话者分离功能 |
| HF_ENDPOINT | string | 否 | - | Hugging Face 模型下载端点，用于自定义模型源 |
| APPID | string | 否 | - | 火山引擎 TTS 服务的 APP ID |
| ACCESS_TOKEN | string | 否 | - | 火山引擎 TTS 服务的访问令牌 |
| BILI_BASE64 | string | 否 | - | Bilibili 上传凭据，用于自动上传视频 |

### 2.3 示例配置

```
# OpenAI 配置
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
MODEL_NAME=gpt-3.5-turbo
OPENAI_API_BASE=https://api.openai.com/v1

# Hugging Face 配置
HF_TOKEN=hf_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# 火山引擎 TTS 配置
APPID=xxxxxxxx
ACCESS_TOKEN=xxxxxxxx

# Bilibili 配置
BILI_BASE64=xxxxxxxx
```

## 3. 批量任务配置文件 (tasks.csv)

### 3.1 文件格式

`tasks.csv` 是一个逗号分隔值文件，用于配置批量处理任务。

### 3.2 字段说明

| 字段名 | 类型 | 必填 | 默认值 | 描述 |
|-------|------|------|--------|------|
| url | string | 是 | - | 视频 URL |
| resolution | string | 是 | 1080p | 视频分辨率，如 720p, 1080p, 4k |
| mode | string | 是 | all | 处理模式，默认为 all |
| status | string | 是 | pending | 任务状态：pending, processing, completed |
| title | string | 否 | - | 视频标题 |
| duration | integer | 否 | - | 视频时长（秒） |
| video_id | string | 否 | - | 视频 ID |
| publish_date | string | 否 | - | 发布日期，格式为 YYYYMMDD |
| uploader | string | 否 | - | 上传者名称 |
| progress | string | 否 | - | 处理进度 |
| start_time | string | 否 | - | 开始时间 |
| end_time | string | 否 | - | 结束时间 |
| output_path | string | 否 | - | 输出路径 |
| error_message | string | 否 | - | 错误信息 |
| task_type | string | 是 | download_only | 任务类型：download_only, full_process |
| steps | string | 是 | 0 | 执行步骤，如 0（仅下载）或 0,1,2,3,4,5,6,7（完整处理） |

### 3.3 示例配置

```csv
url,resolution,mode,status,title,duration,video_id,publish_date,uploader,progress,start_time,end_time,output_path,error_message,task_type,steps
https://www.youtube.com/shorts/ieW8-Qjs5rU,1080p,all,pending,Look at the genius idea,60,ieW8-Qjs5rU,20251114,Alex Demuner,,,,,download_only,0
https://www.youtube.com/watch?v=dBap_Lp-0oc,1080p,all,pending,The Illusion Only Some People Can See,1016,dBap_Lp-0oc,20201231,Veritasium,,,,,full_process,"0,1,2,3,4,5,6,7"
```

## 4. 模型配置文件

### 4.1 config_balanced.yaml

这是一个平衡配置文件，用于调整系统的性能和质量平衡。

#### 4.1.1 主要参数

| 参数名 | 类型 | 默认值 | 描述 |
|-------|------|--------|------|
| whisper_model | string | large-v3 | Whisper 语音识别模型名称 |
| whisper_batch_size | integer | 8 | Whisper 处理的批量大小 |
| demucs_model | string | htdemucs_ft | Demucs 音频分离模型名称 |
| demucs_shifts | integer | 1 | 音频分离时的移位数 |
| tts_model | string | voxcpm-0.5b | TTS 语音合成模型名称 |
| tts_batch_size | integer | 1 | TTS 处理的批量大小 |
| max_workers | integer | 4 | 最大工作线程数 |
| max_retries | integer | 3 | 任务失败后的最大重试次数 |

#### 4.1.2 示例配置

```yaml
whisper_model: large-v3
whisper_batch_size: 8
demucs_model: htdemucs_ft
demucs_shifts: 1
tts_model: voxcpm-0.5b
tts_batch_size: 1
max_workers: 4
max_retries: 3
```

## 5. 启动脚本配置

### 5.1 run_windows.bat

Windows 系统的启动脚本，用于启动 WebUI。

#### 5.1.1 配置参数

| 参数名 | 类型 | 默认值 | 描述 |
|-------|------|--------|------|
| PYTHONPATH | string | . | Python 路径 |
| GRADIO_SERVER_PORT | integer | 7860 | Gradio 服务器端口 |

#### 5.1.2 示例配置

```batch
@echo off
set PYTHONPATH=.
python app.py
pause
```

### 5.2 setup_windows.bat

Windows 系统的安装脚本，用于安装依赖。

#### 5.2.1 配置参数

| 参数名 | 类型 | 默认值 | 描述 |
|-------|------|--------|------|
| VENV_NAME | string | venv | 虚拟环境名称 |
| PYTHON_VERSION | string | 3.10 | Python 版本 |

#### 5.2.2 示例配置

```batch
@echo off
set VENV_NAME=venv
python -m venv %VENV_NAME%
call %VENV_NAME%\Scripts\activate.bat
pip install -r requirements.txt
pip install TTS
echo 安装完成！
pause
```

## 6. 配置文件加载顺序

YouDub-webui 按照以下顺序加载配置：

1. 环境变量（优先级最高）
2. `.env` 文件
3. 命令行参数
4. 配置文件（如 config_balanced.yaml）
5. 默认值（优先级最低）

## 7. 修改配置的方法

### 7.1 修改环境变量

1. 编辑 `.env` 文件
2. 保存文件
3. 重启程序

### 7.2 修改批量任务配置

1. 编辑 `tasks.csv` 文件
2. 保存文件
3. 重新运行批量处理命令

### 7.3 修改模型配置

1. 编辑 `config_balanced.yaml` 文件
2. 保存文件
3. 重启程序或重新运行处理命令

## 8. 最佳实践

### 8.1 环境变量配置

- 敏感信息（如 API 密钥）应放在 `.env` 文件中，不要提交到版本控制系统
- 使用不同的 `.env` 文件区分开发环境和生产环境

### 8.2 批量任务配置

- 使用文本编辑器（如 Notepad++）编辑 `tasks.csv` 文件
- 对于大量任务，建议使用 Excel 或 Google Sheets 编辑，然后导出为 CSV 格式
- 定期备份 `tasks.csv` 文件，防止数据丢失

### 8.3 模型配置

- 根据硬件条件选择合适的模型大小
- 对于 GPU 内存不足的情况，减小批量大小
- 对于处理速度要求高的情况，选择较小的模型

## 9. 常见问题与解决方案

### 9.1 配置文件不生效

- **问题**: 修改了配置文件，但系统没有按照新配置运行
- **解决方案**: 确保重启了程序，检查配置文件格式是否正确，检查配置文件路径是否正确

### 9.2 API 密钥错误

- **问题**: 系统提示 API 密钥错误
- **解决方案**: 检查 `.env` 文件中的 API 密钥是否正确，确保没有多余的空格或换行符

### 9.3 批量任务配置格式错误

- **问题**: 批量处理时提示 CSV 格式错误
- **解决方案**: 检查 `tasks.csv` 文件的格式，确保所有字段都用逗号分隔，字符串用引号括起来

## 10. 配置文件管理

### 10.1 备份配置文件

- 定期备份 `.env` 和 `tasks.csv` 文件
- 建议使用版本控制系统管理配置文件的变更

### 10.2 版本控制

- 将 `.env` 文件添加到 `.gitignore` 中，避免将敏感信息提交到版本控制系统
- 可以创建 `.env.example` 文件作为示例，包含所有必要的环境变量，但不包含实际值

## 11. 总结

配置文件是 YouDub-webui 系统的重要组成部分，通过正确配置这些文件，可以调整系统的行为，满足不同的需求。本文档详细介绍了系统中使用的各种配置文件及其参数，帮助用户正确配置和管理系统。

在修改配置文件时，建议先备份原有配置，然后逐步调整参数，以确保系统的稳定性和可靠性。